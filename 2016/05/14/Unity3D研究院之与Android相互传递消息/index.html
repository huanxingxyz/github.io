<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Unity3D研究院之与Android相互传递消息 | 田鹏飞的个人博客</title>
  <meta name="author" content="huanxingxyz">
  
  <meta name="description" content="原创文章如需转载请注明：转载自雨松MOMO独立域名博客，欢迎大家来访！！雨松MOMO程序研究院本文链接地址:Unity3D研究院之与Android相互传递消息（十九）          上一篇文章我们学习了Unity向Android发送消息，如果Android又能给Unity回馈消息那么这就玩美了。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Unity3D研究院之与Android相互传递消息"/>
  <meta property="og:site_name" content="田鹏飞的个人博客"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">田鹏飞的个人博客</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> Unity3D研究院之与Android相互传递消息</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>原创文章如需转载请注明：转载自雨松MOMO独立域名博客，欢迎大家来访！！雨松MOMO程序研究院本文链接地址:Unity3D研究院之与Android相互传递消息（十九）<br>          上一篇文章我们学习了Unity向Android发送消息，如果Android又能给Unity回馈消息那么这就玩美了。恰好Unity for Andoid 和 IOS一样都是可以相互与Unity发送与接收消息，这篇文章MOMO就和大家好好聊聊Android向Unity发送消息的方法。在读本片博文之前，建议大家读一下我上一篇文章Unity3D研究院之打开Activity与调用JAVA代码传递参数（十八），有关数据打包方面在上一篇中已经说的很清楚，这里就不再赘述。<br>我们在项目中创建两个Activity一个是主Activity一个是新打开的Activity和内容方面与上一篇文章类似。<br>UnityTestActivity.java 主Activity ，提供一个接口方法StartActivity()，它是由Unity中调用</p>
<p>package com.xys;   </p>
<p>import android.content.Context;<br>import android.content.Intent;<br>import android.os.Bundle;   </p>
<p>import com.unity3d.player.UnityPlayerActivity;   </p>
<p>public class UnityTestActivity extends UnityPlayerActivity {<br>    /<em>* Called when the activity is first created. </em>/   </p>
<pre><code>Context mContext = null;   
@Override   
public void onCreate(Bundle savedInstanceState) {   
    super.onCreate(savedInstanceState);   
    mContext = this;   

}   

public void StartActivity0(String name)   
{   
    Intent intent = new Intent(mContext,TestActivity0.class);   
    intent.putExtra(&quot;name&quot;, name);   
    this.startActivity(intent);   
}   
</code></pre><p>}   </p>
<p>接着是TestActivity.java 打开这个界面后，程序将在这里向Unity发送消息。 </p>
<p>package com.xys;   </p>
<p>import com.unity3d.player.UnityPlayer;   </p>
<p>import android.app.Activity;<br>import android.os.Bundle;<br>import android.view.View;<br>import android.view.View.OnClickListener;<br>import android.widget.Button;<br>import android.widget.EditText;<br>import android.widget.TextView;   </p>
<p>public class TestActivity0 extends Activity {   </p>
<pre><code>@Override   
public void onCreate(Bundle savedInstanceState) {   
    super.onCreate(savedInstanceState);   
    setContentView(R.layout.main);   

    TextView text = (TextView)this.findViewById(R.id.textView1);   
    text.setText(this.getIntent().getStringExtra(&quot;name&quot;));   

    final EditText edit = (EditText)this.findViewById(R.id.edit);   

    Button close = (Button)this.findViewById(R.id.button0);   
    close.setOnClickListener(new OnClickListener() {   

        @Override   
        public void onClick(View v) {   
            //注释1   
            UnityPlayer.UnitySendMessage(&quot;Main Camera&quot;,&quot;messgae&quot;,edit.getText().toString());   
            TestActivity0.this.finish();   
        }   
    });   
}   
</code></pre><p>}   </p>
<p> 需要在程序头引入包import com.unity3d.player.UnityPlayer; 因为向Unity发送消息的静态方法写在这里。<br>注释1：意思是点击发送按钮后，程序将向Unity发送消息。UnityPlayer.UnitySendMessage() 参数1表示发送游戏对象的名称，参数2表示对象绑定的脚本接收该消息的方法，参数3表示本条消息发送的字符串信息，这个方法与IOS发送消息的方式非常相像。<br>接着，我们打开Unity工程将Android插件打包好复制在Unity工程当中，详细打包过程请看上一章，将脚本Test.cs绑定在Main Camera对象中，此时由于UnityPlayer.UnitySendMessage()方法发送消息给MainCamera对象，所以需要在Main Camera对象绑定的脚本中去接收这个消息，也就是说要在Test.cs脚本中接收。</p>
<p>下面我们看看Test.cs脚本</p>
<p>using UnityEngine;<br>using System.Collections;   </p>
<p>public class Test : MonoBehaviour<br>{   </p>
<pre><code>//请输入一个字符串   
private string stringToEdit = &quot;Please enter a string&quot;;   

void Update ()   
{   
    //点击手机返回键关闭应用程序   
    if (Input.GetKeyDown(KeyCode.Escape) ¦¦ Input.GetKeyDown(KeyCode.Home) )   
    {   
        Application.Quit();   
    }   
}   

void OnGUI()   
{   
    //绘制一个输入框接收用户输入   
    stringToEdit = GUILayout.TextField (stringToEdit, GUILayout.Width(300),GUILayout.Height(100));   

    //一个提交按钮   
    if(GUILayout.Button(&quot;commit&quot;,GUILayout.Height(50)))   
    {   
        //注解1   
          using (AndroidJavaClass jc = new AndroidJavaClass(&quot;com.unity3d.player.UnityPlayer&quot;))   
        {   
             using( AndroidJavaObject jo = jc.GetStatic&lt;AndroidJavaObject&gt;(&quot;currentActivity&quot;))   
            {   
                //调用Android插件中UnityTestActivity中StartActivity0方法，stringToEdit表示它的参数   
                  jo.Call(&quot;StartActivity0&quot;,stringToEdit);   
            }   

        }   

    }   

}   
//注解2   
void messgae(string str)   
{   
    stringToEdit = str;   
}   
</code></pre><p>}   </p>
<p>注解1：让代码放置在using中是为了告诉垃圾回收站及时的回收垃圾，建议这样来写代码。AndroidJavaClass表示一个java类，AndroidJavaObject表示一个java对象，在上一章已经明确说明。另外还有一些其它的方法，比如调用静态方法等，都在API中写的很清楚，大家可以查阅学习。<br>注解2：刚刚调用的方法UnityPlayer.UnitySendMessage()参数2为”message”，所以程序将调用 Main Camera对象的Test.cs脚本的message方法，参数为Android传递过来的。最后在这里修改了stringToEdit变量刷新了屏幕的UI。</p>
<pre><code> 打开程序后将启动Unity画面，如上图在这里我们写了输入框接收用户的键盘输入，最后用户点击commit按钮程序将打开Android的Activity，并且将字符串“Please enter a string”做为参数传递给了新Activity。




如上图所示，在新打开的Activity中已经看到Please enter a string字符串已经显示在界面当中，在布局文件中同样写了Android的高级控件 输入框与按钮，在输入框中输入字符串“xuanyusong”（任意输入）,点击保存按钮将把”xuanyusong”刚刚输入的字符串传递给Unity。
</code></pre><p>如上图所示，此时在Unity中字符串“xuanyusong”已经显示在输入框中，那么这样就比较完美了实现发送与接收消息。希望大家继续支持雨松MOMO程序研究院。</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2016/05/14/基类和派生类的成员访问/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>上一页</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2016/05/14/Unity3D转换eclipse/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        
    <div class="bdsharebuttonbox">
        <a href="#" class="bds_more" data-cmd="more"></a>
        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
        <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
        <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
        <a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
        <a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a>
        <a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a>
        <a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
    </div>
    <script>
        window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};
        with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>


        

    
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">留言</h2>

  
</section>

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-05-14 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Android-Unity3D/">Android Unity3D<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2016 huanxingxyz
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
