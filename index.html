<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="田鹏飞的个人博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="田鹏飞的个人博客">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="田鹏飞的个人博客">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> 田鹏飞的个人博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">田鹏飞的个人博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">你若盛开，蝴蝶自来</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/Android-应用插件式开发解决方法/" itemprop="url">
                  Android 应用插件式开发解决方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-14T17:45:36+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Android应用插件式开发解决方法</p>
<p>一、现实需求描述</p>
<p>一般的，一个Android应用在开发到了一定阶段以后，功能模块将会越来越多，APK安装包也越来越大，用户在使用过程中也没有办法选择性的加载自己需要的功能模块。此时可能就需要考虑如何分拆整个应用了。<br>二、解决方案提出</p>
<p>一般有两种方式，一种是将应用按照功能分拆成多个应用，用户需要哪个就下载哪个，都需要就都下载。应用之间，可以在代码层面做一定的关联，以共享部分信息。另一种方式，类似于其他平台插件的方式，用户可以在主应用中可以选择性的下载需要的插件，不需要该功能，则不需要下载。<br>第一种方式，只需要开发多个应用就够了。第二种方式稍微复杂，需要做很多额外的工作。这里我们简单讨论第二种方式的大致实现方法。<br>三、实现方法概述</p>
<p>有人可能会想到，是否可以像其他平台那样，下载一个类似于dll文件，或者jar包，就能自动识别并且加载该功能？可惜的是，在Android平台上是不允许直接动态加载jar包的，作者也没有想到类似办法。所以，想实现这种功能，还是要以独立APK的方式来加载。和第一种方式不同的是，从设计的角度，具体的插件是没有独立运行的入口的，也不允许有桌面图标存在，必须从主应用中打开，关闭后回到主应用（插件既然是APK，它安装完怎么会没有入口？怎么会没有桌面图标？QQ的跑酷等游戏不就是插件？不是就有图标入口？）。从用户的角度看，可以在应用中加载需要的功能并且使用，也就类似于其他平台插件的方式了。<br>为了实现这种方式，从设计的角度，就需要考虑清楚哪些功能作为独立的插件提供给用户，这里不再详述。下面从开发的角度说明大致需要做的工作。<br>Ø  主应用中需要开发的框架功能：<br>识别具体的插件是否已经安装（根据插件的package名）<br>如果已经安装要判断是否需要升级（服务器端获取最新的版本和本地的比较）<br>下载并且安装（或者升级）插件<br>卸载该插件<br>Ø  插件APK开发中需要注意的事项：<br>Manifest文件中不要提供启动的入口<br>Ø  主应用和插件之间交互的提示：<br>最好是使用相同的android:sharedUserId，插件可以方便的获取主应用的资源、数据库等等。<br>主应用可以以Intent方式启动具体的插件，同时带入Map类型参数或者json串参数，在插件APK中解析具体参数，实现业务逻辑。<br>三、其他说明</p>
<p>本博客内容并没有具体说明如何去实现，没有代码级别的说明。但是通过上面介绍的方式，开发者基本已经可以理解如何实现插件式的Android应用了。具体的，在开发过程中可能还会遇到很多问题，需要开发者自己摸索和完善。</p>
<p>///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////<br>框架已经放出：<br>Logo<br>android-application-plug-ins-frame-work<br>安卓应用程序插件化开发框架 -AAP Framework</p>
<pre><code>在android的项目开发中，都会遇到后期功能拓展增强与主程序代码变更的现实矛盾，也就是程序的灵活度。
由于linux平台的安全机制，再加上dalvik的特殊机制，各种权限壁垒，使得开发一个灵活多变的程序，变得比较困难，不像pc平台下那么容易。
瞅瞅elipse的插件，瞅瞅360的插件，在android下，我们一开始很难写好一个主程序，然后通过插件机制来应对以后的功能拓展，于是程序变得不那么灵活多变了。
比如一款android下的安全软件，新版本增加了一个功能，如短信拦截，往往会因为一个模块的增加，而重新编译一个apk包，这样周而复始，哪怕只增加50kb的功能代码，用户也需要升级一个完整的apk，往往是5~6M的体积。

最近思来想去，想到一个方法，既然tencent qq在android下面可以以apk的形式来换皮肤，这资源文件的拓展都可以这样简便的搞，为何功能性的拓展就不可以？
</code></pre><p>想出来了两种解决方案。<br>先来说说第一种。</p>
<p>demo下载在最后</p>
<p>先说分析思路。<br>     android下，默认的情况是，每个apk相互独立的，基本上每个应用都是一个dalvik虚拟机，都有一个uid，再配合上linux本身的权限机制，使得apk互通很难直接进行。但作为一个独立应用的集成，不管多少个apk，都可以并为一个单独的dalvik虚拟机，直观的反映给开发人员就是在shell下列出进程，那几个apk同时加载后，会一个进程存在。<br>     这主要就是工程的清单文件 Mainfest中配置了，只需要一句话，以我的测试demo为例：<br>复制代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">      package=&quot;org.igeek.plugintest.main&quot;</span><br><span class="line">      &lt;!-- 就是这句关键代码 --&gt;</span><br><span class="line">      android:sharedUserId=&quot;org.igeek.plugintest&quot;</span><br><span class="line">      android:versionCode=&quot;1&quot;      </span><br><span class="line">      android:versionName=&quot;1.0&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>复制代码</p>
<pre><code>在上面的代码中，android:sharedUserId是指共用一个uid，也就是，凡是这个属性相同的工程，都会共用同一个uid，这样，权限壁垒就消除了，dalvik也会融合为一个，可以测试一下，写几个工程，没有这个属性和有这个属性的情况下，同时运行，在列出当前进程，就直观的说明了。
</code></pre><p>   程序拓展的插件化，当然需要一个主程序，主程序是实现基本功能，以及UI，还有插件的检索以及插件的调用。<br>   这里贴出我demo中的主activity代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">复制代码</span><br><span class="line">  1 public class AndoirdpluginActivity extends ActivityGroup implements OnClickListener ,OnScrollCompleteListener&#123;</span><br><span class="line">  2     private LinearLayout llMainLayout;</span><br><span class="line">  3     </span><br><span class="line">  4     //workspace，看看luncher的源码，这个就是桌面那个多屏的实现</span><br><span class="line">  5     private WorkSpace wkMain;</span><br><span class="line">  6     private Button btnFindPlugins;</span><br><span class="line">  7     private CheckBox chbAttachMain;</span><br><span class="line">  8     </span><br><span class="line">  9     private LocalActivityManager m_ActivityManager;</span><br><span class="line"> 10     </span><br><span class="line"> 11     //这个bean的集合，就相当于插件的描述集合</span><br><span class="line"> 12 //每个bean也就是一个插件的各种描述</span><br><span class="line"> 13     private List&lt;PluginBean&gt; plugins;</span><br><span class="line"> 14     </span><br><span class="line"> 15     @Override</span><br><span class="line"> 16     public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line"> 17         super.onCreate(savedInstanceState);</span><br><span class="line"> 18         setContentView(R.layout.main);</span><br><span class="line"> 19         </span><br><span class="line"> 20         llMainLayout=(LinearLayout) findViewById(R.id.main_llMainLayout);</span><br><span class="line"> 21         wkMain=(WorkSpace) findViewById(R.id.main_wkMain);</span><br><span class="line"> 22         btnFindPlugins=(Button) findViewById(R.id.main_btnFindPlugins);</span><br><span class="line"> 23         chbAttachMain=(CheckBox) findViewById(R.id.main_chbAttachMain);</span><br><span class="line"> 24         </span><br><span class="line"> 25         m_ActivityManager = getLocalActivityManager();</span><br><span class="line"> 26         </span><br><span class="line"> 27         wkMain.setOnScrollCompleteLinstenner(this);</span><br><span class="line"> 28         btnFindPlugins.setOnClickListener(this);</span><br><span class="line"> 29     &#125;</span><br><span class="line"> 30 </span><br><span class="line"> 31     @Override</span><br><span class="line"> 32     public void onClick(View v) &#123;</span><br><span class="line"> 33         attachPlugin(findPlugins());</span><br><span class="line"> 34         btnFindPlugins.setVisibility(View.GONE);</span><br><span class="line"> 35     &#125;</span><br><span class="line"> 36     </span><br><span class="line"> 37     /**</span><br><span class="line"> 38      * 加载插件列表</span><br><span class="line"> 39      * @param plugins</span><br><span class="line"> 40 */</span><br><span class="line"> 41     private void attachPlugin(final List&lt;PluginBean&gt; plugins)&#123;</span><br><span class="line"> 42         Log.e(&quot;ydt&quot;, &quot;   &quot;);</span><br><span class="line"> 43         Log.e(&quot;ydt&quot;, &quot;----- 列出插件&quot;);</span><br><span class="line"> 44         this.plugins=plugins;</span><br><span class="line"> 45         for(final PluginBean plugin:plugins)&#123;</span><br><span class="line"> 46             Button btn=new Button(this);</span><br><span class="line"> 47             btn.setTextColor(Color.RED);</span><br><span class="line"> 48             btn.setText(plugin.getLabel());</span><br><span class="line"> 49             </span><br><span class="line"> 50             llMainLayout.addView(btn);</span><br><span class="line"> 51             //添加事件</span><br><span class="line"> 52             btn.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line"> 53                 </span><br><span class="line"> 54                 @Override</span><br><span class="line"> 55                 public void onClick(View v) &#123;</span><br><span class="line"> 56                     boolean isAttack=chbAttachMain.isChecked();</span><br><span class="line"> 57                     </span><br><span class="line"> 58                     Intent it=new Intent();</span><br><span class="line"> 59                     it.setAction(plugin.getPakageName());</span><br><span class="line"> 60                     </span><br><span class="line"> 61                     //是否附加为view</span><br><span class="line"> 62                     if(isAttack)&#123;</span><br><span class="line"> 63                         //这里偷下懒，这是演示插件作为view附加到主程序中的</span><br><span class="line"> 64                         for(PluginBean plugin:plugins)&#123;</span><br><span class="line"> 65                             </span><br><span class="line"> 66                             Intent itt=new Intent();</span><br><span class="line"> 67                             itt.setAction(plugin.getPakageName());</span><br><span class="line"> 68                             ViewGroup view=(ViewGroup) (m_ActivityManager.startActivity(&quot;&quot;, itt)).getDecorView();</span><br><span class="line"> 69                             wkMain.addView(view);</span><br><span class="line"> 70                         &#125;</span><br><span class="line"> 71                         //一次性附加完毕算了，然后把按钮都删了，看着清净，这几个不是重点</span><br><span class="line"> 72                         llMainLayout.removeAllViews();</span><br><span class="line"> 73                         chbAttachMain.setVisibility(View.GONE);</span><br><span class="line"> 74                         wkMain.setToScreen(0);</span><br><span class="line"> 75                     &#125;else&#123;</span><br><span class="line"> 76                         //这里，不会把插件的窗体附加到主程序中，纯粹无用的演示</span><br><span class="line"> 77                         startActivity(it);</span><br><span class="line"> 78                     &#125;</span><br><span class="line"> 79                 &#125;</span><br><span class="line"> 80             &#125;);</span><br><span class="line"> 81             </span><br><span class="line"> 82         &#125;</span><br><span class="line"> 83     &#125;</span><br><span class="line"> 84     </span><br><span class="line"> 85     /**</span><br><span class="line"> 86      * 查找插件</span><br><span class="line"> 87      * @return</span><br><span class="line"> 88 */</span><br><span class="line"> 89     private List&lt;PluginBean&gt; findPlugins()&#123;</span><br><span class="line"> 90         </span><br><span class="line"> 91         List&lt;PluginBean&gt; plugins=new ArrayList&lt;PluginBean&gt;();</span><br><span class="line"> 92         </span><br><span class="line"> 93         </span><br><span class="line"> 94         //遍历包名，来获取插件</span><br><span class="line"> 95         PackageManager pm=getPackageManager();</span><br><span class="line"> 96         </span><br><span class="line"> 97         </span><br><span class="line"> 98         List&lt;PackageInfo&gt; pkgs=pm.getInstalledPackages(PackageManager.GET_UNINSTALLED_PACKAGES);</span><br><span class="line"> 99         for(PackageInfo pkg    :pkgs)&#123;</span><br><span class="line">100             //包名</span><br><span class="line">101             String packageName=pkg.packageName;</span><br><span class="line">102             String sharedUserId= pkg.sharedUserId;</span><br><span class="line">103             </span><br><span class="line">104             //sharedUserId是开发时约定好的，这样判断是否为自己人</span><br><span class="line">105             if(!&quot;org.igeek.plugintest&quot;.equals(sharedUserId)||&quot;org.igeek.plugintest.main&quot;.equals(packageName))</span><br><span class="line">106                 continue;</span><br><span class="line">107             </span><br><span class="line">108             //进程名</span><br><span class="line">109             String prcessName=pkg.applicationInfo.processName;</span><br><span class="line">110             </span><br><span class="line">111             //label，也就是appName了</span><br><span class="line">112             String label=pm.getApplicationLabel(pkg.applicationInfo).toString();</span><br><span class="line">113             </span><br><span class="line">114             PluginBean plug=new PluginBean();</span><br><span class="line">115             plug.setLabel(label);</span><br><span class="line">116             plug.setPakageName(packageName);</span><br><span class="line">117             </span><br><span class="line">118             plugins.add(plug);</span><br><span class="line">119         &#125;</span><br><span class="line">120         </span><br><span class="line">121         </span><br><span class="line">122         return plugins;</span><br><span class="line">123         </span><br><span class="line">124     &#125;</span><br><span class="line">125 </span><br><span class="line">126  </span><br><span class="line">127     /**</span><br><span class="line">128      * WorkSpace滚动到那个屏，会触发这个事件</span><br><span class="line">129      * 而worksapce中每一屏又是一个插件</span><br><span class="line">130      * 这个事件是用来列出当前屏幕插件所提供的应用，并且让用户调用</span><br><span class="line">131 */</span><br><span class="line">132     @Override</span><br><span class="line">133     public void onScrollComplete(final ScrollEvent e) &#123;</span><br><span class="line">134         try &#123;</span><br><span class="line">135             final Context context = createPackageContext(plugins.get(e.curScreen).getPakageName(), Context.CONTEXT_INCLUDE_CODE|Context.CONTEXT_IGNORE_SECURITY);</span><br><span class="line">136             llMainLayout.removeAllViews();</span><br><span class="line">137             //这几行，通过反射获取了当前插件的描述信息，如同大部分框架的xml一样，这里算是模拟了一下IOC控制反转</span><br><span class="line">138             Class clazz=context.getClassLoader().loadClass(plugins.get(e.curScreen).getPakageName()+&quot;.PluginApplication&quot;);</span><br><span class="line">139             Object o=clazz.newInstance();</span><br><span class="line">140             Map&lt;String,List&lt;String&gt;&gt;  r=(Map&lt;String, List&lt;String&gt;&gt;) clazz.getMethod(&quot;getDesciption&quot;).invoke(o);</span><br><span class="line">141             List&lt;String&gt; classes=r.get(&quot;classes&quot;);</span><br><span class="line">142             List&lt;String&gt; methods=r.get(&quot;methods&quot;);</span><br><span class="line">143             </span><br><span class="line">144             </span><br><span class="line">145             //这里，根据获得的插件所提供的功能，来生成几个按钮显示，供我们调用</span><br><span class="line">146             for(final String clas:classes)&#123;</span><br><span class="line">147                 for(final String method:methods)&#123;</span><br><span class="line">148                     Button btn=new Button(this);</span><br><span class="line">149                     </span><br><span class="line">150                     btn.setText(clas+&quot; -&gt; &quot;+method+&quot; 执行&quot;);</span><br><span class="line">151                     </span><br><span class="line">152                     </span><br><span class="line">153                     //点击后，就执行插件所提供的方法</span><br><span class="line">154                     btn.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">155                         </span><br><span class="line">156                         @Override</span><br><span class="line">157                         public void onClick(View v) &#123;</span><br><span class="line">158                             try &#123;</span><br><span class="line">159                                 Class c=context.getClassLoader().loadClass(plugins.get(e.curScreen).getPakageName()+&quot;.&quot;+clas);</span><br><span class="line">160                                 Object o1=c.newInstance();</span><br><span class="line">161                                 </span><br><span class="line">162                                 //这里注意，context实际上就是句柄，这里如果涉及到窗体，plugin的句柄其实是不行的，因为它没有可以</span><br><span class="line">163 //依附的窗体</span><br><span class="line">164                                 </span><br><span class="line">165 //这个context是plugin的，通过测试，dialog这类行不通,Toast是可以的，因为</span><br><span class="line">166 //Toast是依附于屏幕主窗口的</span><br><span class="line">167 //c.getMethod(method,Context.class).invoke(o1,context); </span><br><span class="line">168                                                         </span><br><span class="line">169 //这里则传递的是主程序的句柄</span><br><span class="line">170                                 c.getMethod(method,Context.class).invoke(o1,AndoirdpluginActivity.this);</span><br><span class="line">171                             </span><br><span class="line">172                             &#125; catch (Exception e) &#123;</span><br><span class="line">173                                 // TODO Auto-generated catch block</span><br><span class="line">174                                 e.printStackTrace();</span><br><span class="line">175                             &#125; </span><br><span class="line">176                         &#125;</span><br><span class="line">177                     &#125;);</span><br><span class="line">178                     llMainLayout.addView(btn);</span><br><span class="line">179                 &#125;</span><br><span class="line">180             &#125;</span><br><span class="line">181             </span><br><span class="line">182         </span><br><span class="line">183         &#125; catch (Exception e1) &#123;</span><br><span class="line">184             // TODO Auto-generated catch block</span><br><span class="line">185             e1.printStackTrace();</span><br><span class="line">186         &#125;</span><br><span class="line">187     </span><br><span class="line">188     &#125;</span><br><span class="line">189 &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>
<pre><code>看注释吧，主要有两点
</code></pre><p>插件的扫描<br>        这种方案是，每个插件以一个单独的apk发布，这样可以在程序中很灵活的知道是否有新的插件，提示用户下载安装，插件的apk清单描述为Action为非Luncher，Category为Default。<br>        主程序侦听packgeManager的安装完成广播，之后扫描同包名（插件当然得这么定义了，只要通过packgeManager能判断是否为自己的插件就行）的apk，之后列出来，让用户选择是否加载。</p>
<p>插件的加载与调用<br>         在获取包后，通过调用系统的api可以得到 sharedUserId 与主程序相同的apk的context，也就是句柄，获得了句柄，通过这个context可以得到classloader，之后就简单了，如何知道这个插件提供什么功能？<br>         这个可以用xml描述，比如这个xml是插件apk的一个资源，就像spring这个框架一样。xml中描述了这个插件有哪些类，提供哪些方法，这些方法需要传入什么参数，返回什么类型。我的demo中为了方便，是用接口，每个插件有一个类提供一个相同的方法，来获取一个map集合，获得这个插件的描述。</p>
<pre><code>ok,到这里就知道加载的插件提供什么功能了。

在上面贴出来的代码中，是循环遍历每个插件，并把每个插件提供的功能以Button的方式显示给用户，点击按钮，就执行了插件的功能，执行时，并不是activity转向（这样就无意义了），而是在主程序自身的context句柄中执行，也就是在自身的窗体中执行。
代码中有一段注释，说明，如果插件有用到context时，记得传递进去的是主程序的context，这样窗体才能附加到这个句柄中，如果传递的是插件的context，它没有一个窗体实例，是无法将一些窗体附加进去的，无任何效果。
</code></pre><p>这里只提供思路，有时间的话研究一下，看能不能搞个通用的框架出来。还有另一种方法，不通过apk形式，以后会写出来。<br>      这里有一些待验证的问题，比如插件的权限问题，如果插件需要的一些权限在主程序中没有声明，会是个什么情况，能不能实时申请呢？这个需要高人指点。或者在主程序中把能声明的权限预先声明了也不错。还有就是native层代码的问题，如果插件包含了native层代码，会是个什么情况，这也需要验证。</p>
<p>这是demo下载：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://files.cnblogs.com/hangxin1940/android_plugin_program.rar</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/Android-解析json/" itemprop="url">
                  Android 解析json
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-14T00:11:34+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###JSON的定义：<br>       一种轻量级的数据交换格式，具有良好的可读和便于快速编写的特性。业内主流技术为其提供了完整的解决方案（有点类似于正则表达式 ，获得了当今大部分语言的支持），从而可以在不同平台间进行数据交换。JSON采用兼容性很高的文本格式，同时也具备类似于C语言体系的行为。 – Json.org</p>
<p>JSON Vs XML</p>
<p>1.JSON和XML的数据可读性基本相同</p>
<p>2.JSON和XML同样拥有丰富的解析手段</p>
<p>3.JSON相对于XML来讲，数据的体积小</p>
<p>4.JSON与JavaScript的交互更加方便</p>
<p>5.JSON对数据的描述性比XML较差</p>
<p>6.JSON的速度要远远快于XML</p>
<p>android2.3提供的json解析类 </p>
<p>android的json解析部分都在包org.json下，主要有以下几个类：<br>JSONObject：可以看作是一个json对象,这是系统中有关JSON定义的基本单元，其包含一对儿(Key/Value)数值。它对外部(External：   应用toString()方法输出的数值)调用的响应体现为一个标准的字符串（例如：{“JSON”: “Hello, World”}，最外被大括号包裹，其中的Key和Value被冒号”:”分隔）。其对于内部(Internal)行为的操作格式略微，例如：初始化一个JSONObject实例，引用内部的put()方法添加数值：new JSONObject().put(“JSON”, “Hello, World!”)，在Key和Value之间是以逗号”,”分隔。Value的类型包括：Boolean、JSONArray、JSONObject、Number、String或者默认值JSONObject.NULL object 。</p>
<p>JSONStringer：json文本构建类 ，根据官方的解释，这个类可以帮助快速和便捷的创建JSON text。其最大的优点在于可以减少由于 格式的错误导致程序异常，引用这个类可以自动严格按照JSON语法规则（syntax rules）创建JSON text。每个JSONStringer实体只能对应创建一个JSON text。。其最大的优点在于可以减少由于格式的错误导致程序异常，引用这个类可以自动严格按照JSON语法规则（syntax rules）创建JSON text。每个JSONStringer实体只能对应创建一个JSON text。</p>
<p>JSONArray：它代表一组有序的数值。将其转换为String输出(toString)所表现的形式是用方括号包裹，数值以逗号”,”分隔（例如：     [value1,value2,value3]，大家可以亲自利用简短的代码更加直观的了解其格式）。这个类的内部同样具有查询行为，     get()和opt()两种方法都可以通过index索引返回指定的数值，put()方法用来添加或者替换数值。同样这个类的value类型可以包括：Boolean、JSONArray、JSONObject、Number、String或者默认值JSONObject.NULL object。</p>
<p>JSONTokener：json解析类<br>JSONException：json中用到的异常 </p>
<p>JSONObject, JSONArray来构建json文本   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">代码  </span><br><span class="line">// 假设现在要创建这样一个json文本  </span><br><span class="line">//  &#123;  </span><br><span class="line">//      &quot;phone&quot; : [&quot;12345678&quot;, &quot;87654321&quot;], // 数组  </span><br><span class="line">//      &quot;name&quot; : &quot;yuanzhifei89&quot;, // 字符串  </span><br><span class="line">//      &quot;age&quot; : 100, // 数值  </span><br><span class="line">//      &quot;address&quot; : &#123; &quot;country&quot; : &quot;china&quot;, &quot;province&quot; : &quot;jiangsu&quot; &#125;, // 对象  </span><br><span class="line">//      &quot;married&quot; : false // 布尔值  </span><br><span class="line">//  &#125;</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">try &#123;  </span><br><span class="line">    // 首先最外层是&#123;&#125;，是创建一个对象  </span><br><span class="line">    JSONObject person = new JSONObject();  </span><br><span class="line">    // 第一个键phone的值是数组，所以需要创建数组对象  </span><br><span class="line">    JSONArray phone = new JSONArray();  </span><br><span class="line">    phone.put(&quot;12345678&quot;).put(&quot;87654321&quot;);  </span><br><span class="line">    person.put(&quot;phone&quot;, phone);  </span><br><span class="line">  </span><br><span class="line">    person.put(&quot;name&quot;, &quot;yuanzhifei89&quot;);  </span><br><span class="line">    person.put(&quot;age&quot;, 100);  </span><br><span class="line">    // 键address的值是对象，所以又要创建一个对象  </span><br><span class="line">    JSONObject address = new JSONObject();  </span><br><span class="line">    address.put(&quot;country&quot;, &quot;china&quot;);  </span><br><span class="line">    address.put(&quot;province&quot;, &quot;jiangsu&quot;);  </span><br><span class="line">    person.put(&quot;address&quot;, address);    </span><br><span class="line">    person.put(&quot;married&quot;, false);  </span><br><span class="line">&#125; catch (JSONException ex) &#123;  </span><br><span class="line">    // 键为null或使用json不支持的数字格式(NaN, infinities)  </span><br><span class="line">    throw new RuntimeException(ex);  </span><br><span class="line">&#125; </span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">getType和optType api的使用   </span><br><span class="line">getType可以将要获取的键的值转换为指定的类型，如果无法转换或没有值则抛出JSONException </span><br><span class="line">optType也是将要获取的键的值转换为指定的类型，无法转换或没有值时返回用户提供或这默认提供的值 </span><br><span class="line">代码  </span><br><span class="line">try &#123;  </span><br><span class="line">    // 所有使用的对象都是用上面创建的对象  </span><br><span class="line">    // 将第一个电话号码转换为数值和将名字转换为数值  </span><br><span class="line">    phone.getLong(0);  </span><br><span class="line">    person.getLong(&quot;name&quot;); // 会抛异常，因为名字无法转换为long        </span><br><span class="line">    phone.optLong(0); // 代码内置的默认值  </span><br><span class="line">    phone.optLong(0, 1000); // 用户提供的默认值  </span><br><span class="line">    person.optLong(&quot;name&quot;);  </span><br><span class="line">    person.optLong(&quot;name&quot;, 1000); // 不像上面那样抛异常，而是返回1000  </span><br><span class="line">&#125; catch (JSONException ex) &#123;  </span><br><span class="line">    // 异常处理代码  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">除了上面的两个类，还可以使用JSONStringer来构建json文本  </span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">Java代码  </span><br><span class="line">try &#123;  </span><br><span class="line">    JSONStringer jsonText = new JSONStringer();  </span><br><span class="line">    // 首先是&#123;，对象开始。object和endObject必须配对使用  </span><br><span class="line">    jsonText.object();  </span><br><span class="line">      </span><br><span class="line">    jsonText.key(&quot;phone&quot;);  </span><br><span class="line">    // 键phone的值是数组。array和endArray必须配对使用  </span><br><span class="line">    jsonText.array();  </span><br><span class="line">    jsonText.value(&quot;12345678&quot;).value(&quot;87654321&quot;);  </span><br><span class="line">    jsonText.endArray();  </span><br><span class="line">      </span><br><span class="line">    jsonText.key(&quot;name&quot;);  </span><br><span class="line">    jsonText.value(&quot;yuanzhifei89&quot;);  </span><br><span class="line">    jsonText.key(&quot;age&quot;);  </span><br><span class="line">    jsonText.value(100);  </span><br><span class="line">      </span><br><span class="line">    jsonText.key(&quot;address&quot;);  </span><br><span class="line">    // 键address的值是对象  </span><br><span class="line">    jsonText.object();  </span><br><span class="line">    jsonText.key(&quot;country&quot;);  </span><br><span class="line">    jsonText.value(&quot;china&quot;);  </span><br><span class="line">    jsonText.key(&quot;province&quot;);  </span><br><span class="line">    jsonText.value(&quot;jiangsu&quot;);  </span><br><span class="line">    jsonText.endObject();  </span><br><span class="line">      </span><br><span class="line">    jsonText.key(&quot;married&quot;);  </span><br><span class="line">    jsonText.value(false);  </span><br><span class="line">      </span><br><span class="line">    // &#125;，对象结束  </span><br><span class="line">    jsonText.endObject();  </span><br><span class="line">&#125; catch (JSONException ex) &#123;  </span><br><span class="line">    throw new RuntimeException(ex);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>json文本解析类JSONTokener<br>按照RFC4627规范将json文本解析为相应的对象。  </p>
<p>对于将json文本解析为对象，只需要用到该类的两个api： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">构造函数  </span><br><span class="line">public Object nextValue();  </span><br><span class="line">代码  </span><br><span class="line">//  &#123;  </span><br><span class="line">//      &quot;phone&quot; : [&quot;12345678&quot;, &quot;87654321&quot;], // 数组  </span><br><span class="line">//      &quot;name&quot; : &quot;yuanzhifei89&quot;, // 字符串  </span><br><span class="line">//      &quot;age&quot; : 100, // 数值  </span><br><span class="line">//      &quot;address&quot; : &#123; &quot;country&quot; : &quot;china&quot;, &quot;province&quot; : &quot;jiangsu&quot; &#125;, // 对象  </span><br><span class="line">//      &quot;married&quot; : false // 布尔值  </span><br><span class="line">//  &#125;  </span><br><span class="line">  </span><br><span class="line">private static final String JSON =   </span><br><span class="line">&quot;&#123;&quot; +  </span><br><span class="line">    &quot;   \&quot;phone\&quot; : [\&quot;12345678\&quot;, \&quot;87654321\&quot;],&quot; +  </span><br><span class="line">    &quot;   \&quot;name\&quot; : \&quot;yuanzhifei89\&quot;,&quot; +  </span><br><span class="line">    &quot;   \&quot;age\&quot; : 100,&quot; +  </span><br><span class="line">    &quot;   \&quot;address\&quot; : &#123; \&quot;country\&quot; : \&quot;china\&quot;, \&quot;province\&quot; : \&quot;jiangsu\&quot; &#125;,&quot; +  </span><br><span class="line">    &quot;   \&quot;married\&quot; : false,&quot; +  </span><br><span class="line">&quot;&#125;&quot;;  </span><br><span class="line">  </span><br><span class="line">try &#123;  </span><br><span class="line">    JSONTokener jsonParser = new JSONTokener(JSON);  </span><br><span class="line">    // 此时还未读取任何json文本，直接读取就是一个JSONObject对象。  </span><br><span class="line">    // 如果此时的读取位置在&quot;name&quot; : 了，那么nextValue就是&quot;yuanzhifei89&quot;（String）  </span><br><span class="line">    JSONObject person = (JSONObject) jsonParser.nextValue();  </span><br><span class="line">    // 接下来的就是JSON对象的操作了  </span><br><span class="line">    person.getJSONArray(&quot;phone&quot;);  </span><br><span class="line">    person.getString(&quot;name&quot;);  </span><br><span class="line">    person.getInt(&quot;age&quot;);  </span><br><span class="line">    person.getJSONObject(&quot;address&quot;);  </span><br><span class="line">    person.getBoolean(&quot;married&quot;);  </span><br><span class="line">&#125; catch (JSONException ex) &#123;  </span><br><span class="line">    // 异常处理代码  </span><br><span class="line">&#125;  </span><br><span class="line">其它的api基本就是用来查看json文本中的文本的 </span><br><span class="line"></span><br><span class="line">代码  </span><br><span class="line">try &#123;  </span><br><span class="line">    JSONTokener jsonParser = new JSONTokener(JSON);  </span><br><span class="line">    // 继续向下读8个json文本中的字符。此时刚开始，即在&#123;处  </span><br><span class="line">    jsonParser.next(8); //&#123;    &quot;phone。tab算一个字符  </span><br><span class="line">      </span><br><span class="line">    // 继续向下读1个json文本中的字符  </span><br><span class="line">    jsonParser.next(); //&quot;  </span><br><span class="line">      </span><br><span class="line">    // 继续向下读取一个json文本中的字符。该字符不是空白、同时也不是注视中的字符  </span><br><span class="line">    jsonParser.nextClean(); //:  </span><br><span class="line">      </span><br><span class="line">    // 返回当前的读取位置到第一次遇到&apos;a&apos;之间的字符串（不包括a）。  </span><br><span class="line">    jsonParser.nextString(&apos;a&apos;); //  [&quot;12345678&quot;, &quot;87654321&quot;],    &quot;n（前面有两个空格）  </span><br><span class="line">      </span><br><span class="line">    // 返回当前读取位置到第一次遇到字符串中(如&quot;0089&quot;)任意字符之间的字符串，同时该字符是trimmed的。（此处就是第一次遇到了89）  </span><br><span class="line">    jsonParser.nextTo(&quot;0089&quot;); //me&quot; : &quot;yuanzhifei  </span><br><span class="line">      </span><br><span class="line">    // 读取位置撤销一个  </span><br><span class="line">    jsonParser.back();  </span><br><span class="line">    jsonParser.next(); //i  </span><br><span class="line">      </span><br><span class="line">    // 读取位置前进到指定字符串处（包括字符串）  </span><br><span class="line">    jsonParser.skipPast(&quot;address&quot;);  </span><br><span class="line">    jsonParser.next(8); //&quot; : &#123; &quot;c  </span><br><span class="line">      </span><br><span class="line">    // 读取位置前进到执行字符处（不包括字符）  </span><br><span class="line">    jsonParser.skipTo(&apos;m&apos;);  </span><br><span class="line">    jsonParser.next(8); //married&quot;  </span><br><span class="line">&#125; catch (JSONException ex) &#123;  </span><br><span class="line">    // 异常处理代码  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line">      以下是一个标准的JSON请求实现过程：</span><br><span class="line"></span><br><span class="line">01</span><br><span class="line">HttpPost request = newHttpPost(url); </span><br><span class="line">02</span><br><span class="line">// 先封装一个 JSON 对象 </span><br><span class="line">03</span><br><span class="line">JSONObject param = newJSONObject(); </span><br><span class="line">04</span><br><span class="line">param.put(&quot;name&quot;, &quot;rarnu&quot;); </span><br><span class="line">05</span><br><span class="line">param.put(&quot;password&quot;, &quot;123456&quot;); </span><br><span class="line">06</span><br><span class="line">// 绑定到请求 Entry </span><br><span class="line">07</span><br><span class="line">StringEntity se = newStringEntity(param.toString());  </span><br><span class="line">08</span><br><span class="line">request.setEntity(se); </span><br><span class="line">09</span><br><span class="line">// 发送请求 </span><br><span class="line">10</span><br><span class="line">HttpResponse httpResponse = newDefaultHttpClient().execute(request); </span><br><span class="line">11</span><br><span class="line">// 得到应答的字符串，这也是一个 JSON 格式保存的数据 </span><br><span class="line">12</span><br><span class="line">String retSrc = EntityUtils.toString(httpResponse.getEntity()); </span><br><span class="line">13</span><br><span class="line">// 生成 JSON 对象 </span><br><span class="line">14</span><br><span class="line">JSONObject result = newJSONObject( retSrc); </span><br><span class="line">15</span><br><span class="line">String token = result.get(&quot;token&quot;);</span><br><span class="line"></span><br><span class="line">        下面这个是自己修改别人的小例子，主要是加一些注释和讲解，这个例子主要是使用android进行json解析。 </span><br><span class="line">1</span><br><span class="line">单数据&#123;&apos;singer&apos;:&#123;&apos;id&apos;:01,&apos;name&apos;:&apos;tom&apos;,&apos;gender&apos;:&apos;男&apos;&#125;&#125;</span><br><span class="line">2</span><br><span class="line">多个数据&#123;&quot;singers&quot;:[</span><br><span class="line">3</span><br><span class="line">        &#123;&apos;id&apos;:02,&apos;name&apos;:&apos;tom&apos;,&apos;gender&apos;:&apos;男&apos;&#125;,</span><br><span class="line">4</span><br><span class="line">         &#123;&apos;id&apos;:03,&apos;name&apos;:&apos;jerry,&apos;gender&apos;:&apos;男&apos;&#125;,</span><br><span class="line">5</span><br><span class="line">&#123;&apos;id&apos;:04,&apos;name&apos;:&apos;jim,&apos;gender&apos;:&apos;男&apos;&#125;,</span><br><span class="line">6</span><br><span class="line">&#123;&apos;id&apos;:05,&apos;name&apos;:&apos;lily,&apos;gender&apos;:&apos;女&apos;&#125;]&#125;</span><br><span class="line">        下面的类主要是解析单个数据parseJson（）和多个数据的方法parseJsonMulti（）: </span><br><span class="line">01</span><br><span class="line">public class JsonActivity extends Activity &#123; </span><br><span class="line">02</span><br><span class="line">    /** Called when the activity is first created. */ </span><br><span class="line">03</span><br><span class="line">    private TextView tvJson; </span><br><span class="line">04</span><br><span class="line">    private Button btnJson; </span><br><span class="line">05</span><br><span class="line">    private Button btnJsonMulti; </span><br><span class="line">06</span><br><span class="line">    @Override </span><br><span class="line">07</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123; </span><br><span class="line">08</span><br><span class="line">        super.onCreate(savedInstanceState); </span><br><span class="line">09</span><br><span class="line">        setContentView(R.layout.main); </span><br><span class="line">10</span><br><span class="line">        tvJson = (TextView) this.findViewById(R.id.tvJson); </span><br><span class="line">11</span><br><span class="line">        btnJson = (Button) this.findViewById(R.id.btnJson); </span><br><span class="line">12</span><br><span class="line">        btnJsonMulti = (Button) this.findViewById(R.id.btnJsonMulti); </span><br><span class="line">13</span><br><span class="line">        btnJson.setOnClickListener(new View.OnClickListener() &#123; </span><br><span class="line">14</span><br><span class="line">            @Override </span><br><span class="line">15</span><br><span class="line">            public void onClick(View v) &#123; </span><br><span class="line">16</span><br><span class="line">                // url </span><br><span class="line">17</span><br><span class="line">                // String strUrl = &quot;http://10.158.166.110:8080/AndroidServer/JsonServlet&quot;; </span><br><span class="line">18</span><br><span class="line">                String strUrl = ServerPageUtil.getStrUrl(UrlsOfServer.JSON_SINGER); </span><br><span class="line">19</span><br><span class="line">                //获得返回的Json字符串 </span><br><span class="line">20</span><br><span class="line">                String strResult = connServerForResult(strUrl); </span><br><span class="line">21</span><br><span class="line">                //解析Json字符串 </span><br><span class="line">22</span><br><span class="line">                parseJson(strResult); </span><br><span class="line">23</span><br><span class="line">            &#125; </span><br><span class="line">24</span><br><span class="line">        &#125;); </span><br><span class="line">25</span><br><span class="line">        btnJsonMulti.setOnClickListener(new View.OnClickListener() &#123; </span><br><span class="line">26</span><br><span class="line">            @Override </span><br><span class="line">27</span><br><span class="line">            public void onClick(View v) &#123; </span><br><span class="line">28</span><br><span class="line">                String strUrl = ServerPageUtil.getStrUrl(UrlsOfServer.JSON_SINGERS); </span><br><span class="line">29</span><br><span class="line">                String strResult = connServerForResult(strUrl); </span><br><span class="line">30</span><br><span class="line">                //获得多个Singer </span><br><span class="line">31</span><br><span class="line">                parseJsonMulti(strResult); </span><br><span class="line">32</span><br><span class="line">            &#125; </span><br><span class="line">33</span><br><span class="line">        &#125;); </span><br><span class="line">34</span><br><span class="line">    &#125; </span><br><span class="line">35</span><br><span class="line">    private String connServerForResult(String strUrl) &#123; </span><br><span class="line">36</span><br><span class="line">        // HttpGet对象 </span><br><span class="line">37</span><br><span class="line">        HttpGet httpRequest = new HttpGet(strUrl); </span><br><span class="line">38</span><br><span class="line">        String strResult = &quot;&quot;; </span><br><span class="line">39</span><br><span class="line">        try &#123; </span><br><span class="line">40</span><br><span class="line">            // HttpClient对象 </span><br><span class="line">41</span><br><span class="line">            HttpClient httpClient = new DefaultHttpClient(); </span><br><span class="line">42</span><br><span class="line">            // 获得HttpResponse对象 </span><br><span class="line">43</span><br><span class="line">            HttpResponse httpResponse = httpClient.execute(httpRequest); </span><br><span class="line">44</span><br><span class="line">            if (httpResponse.getStatusLine().getStatusCode() == HttpStatus.SC_OK) &#123; </span><br><span class="line">45</span><br><span class="line">                // 取得返回的数据 </span><br><span class="line">46</span><br><span class="line">                strResult = EntityUtils.toString(httpResponse.getEntity()); </span><br><span class="line">47</span><br><span class="line">            &#125; </span><br><span class="line">48</span><br><span class="line">        &#125; catch (ClientProtocolException e) &#123; </span><br><span class="line">49</span><br><span class="line">            tvJson.setText(&quot;protocol error&quot;); </span><br><span class="line">50</span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">51</span><br><span class="line">        &#125; catch (IOException e) &#123; </span><br><span class="line">52</span><br><span class="line">            tvJson.setText(&quot;IO error&quot;); </span><br><span class="line">53</span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">54</span><br><span class="line">        &#125; </span><br><span class="line">55</span><br><span class="line">        return strResult; </span><br><span class="line">56</span><br><span class="line">    &#125; </span><br><span class="line">57</span><br><span class="line">    // 普通Json数据解析 </span><br><span class="line">58</span><br><span class="line">    private void parseJson(String strResult) &#123; </span><br><span class="line">59</span><br><span class="line">        try &#123; </span><br><span class="line">60</span><br><span class="line">            JSONObject jsonObj = new JSONObject(strResult).getJSONObject(&quot;singer&quot;); </span><br><span class="line">61</span><br><span class="line">            int id = jsonObj.getInt(&quot;id&quot;); </span><br><span class="line">62</span><br><span class="line">            String name = jsonObj.getString(&quot;name&quot;); </span><br><span class="line">63</span><br><span class="line">            String gender = jsonObj.getString(&quot;gender&quot;); </span><br><span class="line">64</span><br><span class="line">            tvJson.setText(&quot;ID号&quot;+id + &quot;, 姓名：&quot; + name + &quot;,性别：&quot; + gender); </span><br><span class="line">65</span><br><span class="line">        &#125; catch (JSONException e) &#123; </span><br><span class="line">66</span><br><span class="line">            System.out.println(&quot;Json parse error&quot;); </span><br><span class="line">67</span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">68</span><br><span class="line">        &#125; </span><br><span class="line">69</span><br><span class="line">    &#125; </span><br><span class="line">70</span><br><span class="line">    //解析多个数据的Json</span><br><span class="line">71</span><br><span class="line">    private void parseJsonMulti(String strResult) &#123; </span><br><span class="line">72</span><br><span class="line">        try &#123; </span><br><span class="line">73</span><br><span class="line">            JSONArray jsonObjs = new JSONObject(strResult).getJSONArray(&quot;singers&quot;); </span><br><span class="line">74</span><br><span class="line">            String s = &quot;&quot;; </span><br><span class="line">75</span><br><span class="line">            for(int i = 0; i &lt; jsonObjs.length() ; i++)&#123; </span><br><span class="line">76</span><br><span class="line">                JSONObject jsonObj = ((JSONObject)jsonObjs.opt(i)) </span><br><span class="line">77</span><br><span class="line">                .getJSONObject(&quot;singer&quot;); </span><br><span class="line">78</span><br><span class="line">                int id = jsonObj.getInt(&quot;id&quot;); </span><br><span class="line">79</span><br><span class="line">                String name = jsonObj.getString(&quot;name&quot;); </span><br><span class="line">80</span><br><span class="line">                String gender = jsonObj.getString(&quot;gender&quot;); </span><br><span class="line">81</span><br><span class="line">                s +=  &quot;ID号&quot;+id + &quot;, 姓名：&quot; + name + &quot;,性别：&quot; + gender+ &quot;\n&quot; ; </span><br><span class="line">82</span><br><span class="line">            &#125; </span><br><span class="line">83</span><br><span class="line">            tvJson.setText(s); </span><br><span class="line">84</span><br><span class="line">        &#125; catch (JSONException e) &#123; </span><br><span class="line">85</span><br><span class="line">            System.out.println(&quot;Jsons parse error !&quot;); </span><br><span class="line">86</span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">87</span><br><span class="line">        &#125; </span><br><span class="line">88</span><br><span class="line">    &#125; </span><br><span class="line">89</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/Android-应用版本更新/" itemprop="url">
                  Android 应用版本更新
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-14T00:04:55+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一个好的应用软件都是需要好的维护，从初出版本到最后精品，这个过程需要版本不停的更新，那么如何让用户第一时间获取最新的应用安装包呢？那么就要求我们从第一个版本就要实现升级模块这一功能。</p>
<p>自动更新功能的实现原理，就是我们事先和后台协商好一个接口，我们在应用的主Activity里，去访问这个接口，如果需要更新，后台会返回一些数据(比 如，提示语；最新版本的url等)。然后我们给出提示框，用户点击开始下载，下载完成开始覆盖安装程序，这样用户的应用就保持最新的拉。</p>
<p>为了让大家容易理解，我像往常一样准备一个小例子，这里为了方便我就省去了和后台交互部分了。步骤分别如下：</p>
<p>第一步：新建一个Android工程命名为:UpdateDemo.代码结构如下图所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br></pre></td><td class="code"><pre><span class="line">Android 软件自动更新功能的实现！！！</span><br><span class="line"></span><br><span class="line">第二步：新建一个UpdateManager.java类，负责软件更新功能模块，代码如下：</span><br><span class="line"></span><br><span class="line">001</span><br><span class="line">package com.tutor.update;</span><br><span class="line">002</span><br><span class="line"></span><br><span class="line">003</span><br><span class="line">import java.io.File;</span><br><span class="line">004</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">005</span><br><span class="line">import java.io.IOException;</span><br><span class="line">006</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">007</span><br><span class="line">import java.net.HttpURLConnection;</span><br><span class="line">008</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">009</span><br><span class="line">import java.net.URL;</span><br><span class="line">010</span><br><span class="line"></span><br><span class="line">011</span><br><span class="line"></span><br><span class="line">012</span><br><span class="line">import android.app.AlertDialog;</span><br><span class="line">013</span><br><span class="line">import android.app.Dialog;</span><br><span class="line">014</span><br><span class="line">import android.app.AlertDialog.Builder;</span><br><span class="line">015</span><br><span class="line">import android.content.Context;</span><br><span class="line">016</span><br><span class="line">import android.content.DialogInterface;</span><br><span class="line">017</span><br><span class="line">import android.content.Intent;</span><br><span class="line">018</span><br><span class="line">import android.content.DialogInterface.OnClickListener;</span><br><span class="line">019</span><br><span class="line">import android.net.Uri;</span><br><span class="line">020</span><br><span class="line">import android.os.Handler;</span><br><span class="line">021</span><br><span class="line">import android.os.Message;</span><br><span class="line">022</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">023</span><br><span class="line">import android.view.View;</span><br><span class="line">024</span><br><span class="line">import android.widget.ProgressBar;</span><br><span class="line">025</span><br><span class="line"></span><br><span class="line">026</span><br><span class="line">public class UpdateManager &#123;</span><br><span class="line">027</span><br><span class="line"></span><br><span class="line">028</span><br><span class="line">    private Context mContext;</span><br><span class="line">029</span><br><span class="line">     </span><br><span class="line">030</span><br><span class="line">    //提示语</span><br><span class="line">031</span><br><span class="line">    private String updateMsg = &quot;有最新的软件包哦，亲快下载吧~&quot;;</span><br><span class="line">032</span><br><span class="line">     </span><br><span class="line">033</span><br><span class="line">    //返回的安装包url</span><br><span class="line">034</span><br><span class="line">    privateString apkUrl = &quot;http://softfile.3g.qq.com:8080/msoft/179/24659/43549/qq_hd_mini_1.4.apk&quot;;</span><br><span class="line">035</span><br><span class="line">     </span><br><span class="line">036</span><br><span class="line">     </span><br><span class="line">037</span><br><span class="line">    private Dialog noticeDialog;</span><br><span class="line">038</span><br><span class="line">     </span><br><span class="line">039</span><br><span class="line">    private Dialog downloadDialog;</span><br><span class="line">040</span><br><span class="line">     /* 下载包安装路径 */</span><br><span class="line">041</span><br><span class="line">    private static final String savePath = &quot;/sdcard/updatedemo/&quot;;</span><br><span class="line">042</span><br><span class="line">     </span><br><span class="line">043</span><br><span class="line">    private static final String saveFileName = savePath + &quot;UpdateDemoRelease.apk&quot;;</span><br><span class="line">044</span><br><span class="line"></span><br><span class="line">045</span><br><span class="line">    /* 进度条与通知ui刷新的handler和msg常量 */</span><br><span class="line">046</span><br><span class="line">    private ProgressBar mProgress;</span><br><span class="line">047</span><br><span class="line"></span><br><span class="line">048</span><br><span class="line">     </span><br><span class="line">049</span><br><span class="line">    private static final int DOWN_UPDATE = 1;</span><br><span class="line">050</span><br><span class="line">     </span><br><span class="line">051</span><br><span class="line">    private static final int DOWN_OVER = 2;</span><br><span class="line">052</span><br><span class="line">     </span><br><span class="line">053</span><br><span class="line">    private int progress;</span><br><span class="line">054</span><br><span class="line">     </span><br><span class="line">055</span><br><span class="line">    private Thread downLoadThread;</span><br><span class="line">056</span><br><span class="line">     </span><br><span class="line">057</span><br><span class="line">    private boolean interceptFlag = false;</span><br><span class="line">058</span><br><span class="line">     </span><br><span class="line">059</span><br><span class="line">    private Handler mHandler = new Handler()&#123;</span><br><span class="line">060</span><br><span class="line">        public void handleMessage(Message msg) &#123;</span><br><span class="line">061</span><br><span class="line">            switch (msg.what) &#123;</span><br><span class="line">062</span><br><span class="line">            case DOWN_UPDATE:</span><br><span class="line">063</span><br><span class="line">                mProgress.setProgress(progress);</span><br><span class="line">064</span><br><span class="line">                break;</span><br><span class="line">065</span><br><span class="line">            case DOWN_OVER:</span><br><span class="line">066</span><br><span class="line">                 </span><br><span class="line">067</span><br><span class="line">                installApk();</span><br><span class="line">068</span><br><span class="line">                break;</span><br><span class="line">069</span><br><span class="line">            default:</span><br><span class="line">070</span><br><span class="line">                break;</span><br><span class="line">071</span><br><span class="line">            &#125;</span><br><span class="line">072</span><br><span class="line">        &#125;;</span><br><span class="line">073</span><br><span class="line">    &#125;;</span><br><span class="line">074</span><br><span class="line">     </span><br><span class="line">075</span><br><span class="line">    public UpdateManager(Context context) &#123;</span><br><span class="line">076</span><br><span class="line">        this.mContext = context;</span><br><span class="line">077</span><br><span class="line">    &#125;</span><br><span class="line">078</span><br><span class="line">     </span><br><span class="line">079</span><br><span class="line">    //外部接口让主Activity调用</span><br><span class="line">080</span><br><span class="line">    public void checkUpdateInfo()&#123;</span><br><span class="line">081</span><br><span class="line">        showNoticeDialog();</span><br><span class="line">082</span><br><span class="line">    &#125;</span><br><span class="line">083</span><br><span class="line">     </span><br><span class="line">084</span><br><span class="line">     </span><br><span class="line">085</span><br><span class="line">    private void showNoticeDialog()&#123;</span><br><span class="line">086</span><br><span class="line">        AlertDialog.Builder builder = new Builder(mContext);</span><br><span class="line">087</span><br><span class="line">        builder.setTitle(&quot;软件版本更新&quot;);</span><br><span class="line">088</span><br><span class="line">        builder.setMessage(updateMsg);</span><br><span class="line">089</span><br><span class="line">        builder.setPositiveButton(&quot;下载&quot;, new OnClickListener() &#123;        </span><br><span class="line">090</span><br><span class="line">            @Override</span><br><span class="line">091</span><br><span class="line">            public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">092</span><br><span class="line">                dialog.dismiss();</span><br><span class="line">093</span><br><span class="line">                showDownloadDialog();          </span><br><span class="line">094</span><br><span class="line">            &#125;</span><br><span class="line">095</span><br><span class="line">        &#125;);</span><br><span class="line">096</span><br><span class="line">        builder.setNegativeButton(&quot;以后再说&quot;, new OnClickListener() &#123;          </span><br><span class="line">097</span><br><span class="line">            @Override</span><br><span class="line">098</span><br><span class="line">            public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">099</span><br><span class="line">                dialog.dismiss();              </span><br><span class="line">100</span><br><span class="line">            &#125;</span><br><span class="line">101</span><br><span class="line">        &#125;);</span><br><span class="line">102</span><br><span class="line">        noticeDialog = builder.create();</span><br><span class="line">103</span><br><span class="line">        noticeDialog.show();</span><br><span class="line">104</span><br><span class="line">    &#125;</span><br><span class="line">105</span><br><span class="line">     </span><br><span class="line">106</span><br><span class="line">    private void showDownloadDialog()&#123;</span><br><span class="line">107</span><br><span class="line">        AlertDialog.Builder builder = new Builder(mContext);</span><br><span class="line">108</span><br><span class="line">        builder.setTitle(&quot;软件版本更新&quot;);</span><br><span class="line">109</span><br><span class="line">         </span><br><span class="line">110</span><br><span class="line">        final LayoutInflater inflater = LayoutInflater.from(mContext);</span><br><span class="line">111</span><br><span class="line">        View v = inflater.inflate(R.layout.progress, null);</span><br><span class="line">112</span><br><span class="line">        mProgress = (ProgressBar)v.findViewById(R.id.progress);</span><br><span class="line">113</span><br><span class="line">         </span><br><span class="line">114</span><br><span class="line">        builder.setView(v);</span><br><span class="line">115</span><br><span class="line">        builder.setNegativeButton(&quot;取消&quot;, new OnClickListener() &#123;</span><br><span class="line">116</span><br><span class="line">            @Override</span><br><span class="line">117</span><br><span class="line">            public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">118</span><br><span class="line">                dialog.dismiss();</span><br><span class="line">119</span><br><span class="line">                interceptFlag = true;</span><br><span class="line">120</span><br><span class="line">            &#125;</span><br><span class="line">121</span><br><span class="line">        &#125;);</span><br><span class="line">122</span><br><span class="line">        downloadDialog = builder.create();</span><br><span class="line">123</span><br><span class="line">        downloadDialog.show();</span><br><span class="line">124</span><br><span class="line">         </span><br><span class="line">125</span><br><span class="line">        downloadApk();</span><br><span class="line">126</span><br><span class="line">    &#125;</span><br><span class="line">127</span><br><span class="line">     </span><br><span class="line">128</span><br><span class="line">    private Runnable mdownApkRunnable = new Runnable() &#123;   </span><br><span class="line">129</span><br><span class="line">        @Override</span><br><span class="line">130</span><br><span class="line">        public void run() &#123;</span><br><span class="line">131</span><br><span class="line">            try &#123;</span><br><span class="line">132</span><br><span class="line">                URL url = new URL(apkUrl);</span><br><span class="line">133</span><br><span class="line">             </span><br><span class="line">134</span><br><span class="line">                HttpURLConnection conn = (HttpURLConnection)url.openConnection();</span><br><span class="line">135</span><br><span class="line">                conn.connect();</span><br><span class="line">136</span><br><span class="line">                int length = conn.getContentLength();</span><br><span class="line">137</span><br><span class="line">                InputStream is = conn.getInputStream();</span><br><span class="line">138</span><br><span class="line">                 </span><br><span class="line">139</span><br><span class="line">                File file = new File(savePath);</span><br><span class="line">140</span><br><span class="line">                if(!file.exists())&#123;</span><br><span class="line">141</span><br><span class="line">                    file.mkdir();</span><br><span class="line">142</span><br><span class="line">                &#125;</span><br><span class="line">143</span><br><span class="line">                String apkFile = saveFileName;</span><br><span class="line">144</span><br><span class="line">                File ApkFile = new File(apkFile);</span><br><span class="line">145</span><br><span class="line">                FileOutputStream fos = new FileOutputStream(ApkFile);</span><br><span class="line">146</span><br><span class="line">                 </span><br><span class="line">147</span><br><span class="line">                int count = 0;</span><br><span class="line">148</span><br><span class="line">                byte buf[] = new byte[1024];</span><br><span class="line">149</span><br><span class="line">                 </span><br><span class="line">150</span><br><span class="line">                do&#123;                </span><br><span class="line">151</span><br><span class="line">                    int numread = is.read(buf);</span><br><span class="line">152</span><br><span class="line">                    count += numread;</span><br><span class="line">153</span><br><span class="line">                    progress =(int)(((float)count / length) * 100);</span><br><span class="line">154</span><br><span class="line">                    //更新进度</span><br><span class="line">155</span><br><span class="line">                    mHandler.sendEmptyMessage(DOWN_UPDATE);</span><br><span class="line">156</span><br><span class="line">                    if(numread &lt;= 0)&#123;   </span><br><span class="line">157</span><br><span class="line">                        //下载完成通知安装</span><br><span class="line">158</span><br><span class="line">                        mHandler.sendEmptyMessage(DOWN_OVER);</span><br><span class="line">159</span><br><span class="line">                        break;</span><br><span class="line">160</span><br><span class="line">                    &#125;</span><br><span class="line">161</span><br><span class="line">                    fos.write(buf,0,numread);</span><br><span class="line">162</span><br><span class="line">                &#125;while(!interceptFlag);//点击取消就停止下载.</span><br><span class="line">163</span><br><span class="line">                 </span><br><span class="line">164</span><br><span class="line">                fos.close();</span><br><span class="line">165</span><br><span class="line">                is.close();</span><br><span class="line">166</span><br><span class="line">            &#125; catch (MalformedURLException e) &#123;</span><br><span class="line">167</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">168</span><br><span class="line">            &#125; catch(IOException e)&#123;</span><br><span class="line">169</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">170</span><br><span class="line">            &#125;</span><br><span class="line">171</span><br><span class="line">             </span><br><span class="line">172</span><br><span class="line">        &#125;</span><br><span class="line">173</span><br><span class="line">    &#125;;</span><br><span class="line">174</span><br><span class="line">     </span><br><span class="line">175</span><br><span class="line">     /**</span><br><span class="line">176</span><br><span class="line">     * 下载apk</span><br><span class="line">177</span><br><span class="line">     * @param url</span><br><span class="line">178</span><br><span class="line">     */</span><br><span class="line">179</span><br><span class="line">     </span><br><span class="line">180</span><br><span class="line">    private void downloadApk()&#123;</span><br><span class="line">181</span><br><span class="line">        downLoadThread = new Thread(mdownApkRunnable);</span><br><span class="line">182</span><br><span class="line">        downLoadThread.start();</span><br><span class="line">183</span><br><span class="line">    &#125;</span><br><span class="line">184</span><br><span class="line">     /**</span><br><span class="line">185</span><br><span class="line">     * 安装apk</span><br><span class="line">186</span><br><span class="line">     * @param url</span><br><span class="line">187</span><br><span class="line">     */</span><br><span class="line">188</span><br><span class="line">    private void installApk()&#123;</span><br><span class="line">189</span><br><span class="line">        File apkfile = new File(saveFileName);</span><br><span class="line">190</span><br><span class="line">        if (!apkfile.exists()) &#123;</span><br><span class="line">191</span><br><span class="line">            return;</span><br><span class="line">192</span><br><span class="line">        &#125;   </span><br><span class="line">193</span><br><span class="line">        Intent i = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">194</span><br><span class="line">        i.setDataAndType(Uri.parse(&quot;file://&quot;+ apkfile.toString()), &quot;application/vnd.android.package-archive&quot;);</span><br><span class="line">195</span><br><span class="line">        mContext.startActivity(i);</span><br><span class="line">196</span><br><span class="line">     </span><br><span class="line">197</span><br><span class="line">    &#125;</span><br><span class="line">198</span><br><span class="line">&#125;</span><br><span class="line">第三步：在MainActivity.java也就是主Activity调用,代码如下:</span><br><span class="line">01</span><br><span class="line">package com.tutor.update;</span><br><span class="line">02</span><br><span class="line"></span><br><span class="line">03</span><br><span class="line">import android.app.Activity;</span><br><span class="line">04</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">05</span><br><span class="line"></span><br><span class="line">06</span><br><span class="line">public class MainAcitivity extends Activity &#123;</span><br><span class="line">07</span><br><span class="line">     </span><br><span class="line">08</span><br><span class="line"></span><br><span class="line">09</span><br><span class="line">    private UpdateManager mUpdateManager;</span><br><span class="line">10</span><br><span class="line">    @Override</span><br><span class="line">11</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">12</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">13</span><br><span class="line">        setContentView(R.layout.main);</span><br><span class="line">14</span><br><span class="line">         </span><br><span class="line">15</span><br><span class="line">        //这里来检测版本是否需要更新</span><br><span class="line">16</span><br><span class="line">        mUpdateManager = new UpdateManager(this);</span><br><span class="line">17</span><br><span class="line">        mUpdateManager.checkUpdateInfo();</span><br><span class="line">18</span><br><span class="line">    &#125;    </span><br><span class="line">19</span><br><span class="line">&#125;</span><br><span class="line">第四步：添加程序所用的资源与权限：</span><br><span class="line">下载的时候用到了ProgressBar,所以事先写了一个progress.xml布局文件，代码如下:</span><br><span class="line"></span><br><span class="line">01</span><br><span class="line">&lt;!--?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?--&gt;</span><br><span class="line">02</span><br><span class="line"></span><br><span class="line">03</span><br><span class="line"></span><br><span class="line">04</span><br><span class="line"></span><br><span class="line">05</span><br><span class="line"></span><br><span class="line">06</span><br><span class="line">&lt;linearlayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;android:layout_width=&quot;fill_parent&quot; android:layout_height=&quot;wrap_content&quot;&gt;  </span><br><span class="line">07</span><br><span class="line"></span><br><span class="line">08</span><br><span class="line">  </span><br><span class="line">09</span><br><span class="line">  </span><br><span class="line">10</span><br><span class="line">  </span><br><span class="line">11</span><br><span class="line">  </span><br><span class="line">12</span><br><span class="line"> &lt;progressbar style=&quot;android:attr/progressBarStyleHorizontal;&quot;android:layout_width=&quot;fill_parent&quot; android:layout_height=&quot;wrap_content&quot;android:id=&quot;@+id/progress&quot;&gt;</span><br><span class="line">13</span><br><span class="line">  </span><br><span class="line">14</span><br><span class="line">  </span><br><span class="line">15</span><br><span class="line">  </span><br><span class="line">16</span><br><span class="line">  </span><br><span class="line">17</span><br><span class="line"> &lt;/progressbar&gt;</span><br><span class="line">18</span><br><span class="line"></span><br><span class="line">19</span><br><span class="line"></span><br><span class="line">20</span><br><span class="line"></span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">22</span><br><span class="line">&lt;/linearlayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">下载的时候用到了网</span><br><span class="line">络部分，所以要在AndroidManifest.xml中添加网络权限，代码如下:</span><br></pre></td></tr></table></figure>
<p>1</p>
<p><uses-permission android:name="android.permission.INTERNET"></uses-permission></p>
<p>```<br>第五步:运行查看效果如下:<br>Android 软件自动更新功能的实现！！！     Android 软件自动更新功能的实现！！！</p>
<p> 图一:提示有最新包                                                                                   图二：点击开始下载</p>
<p>Android 软件自动更新功能的实现！！！</p>
<p>图三：下载完开始安装，我这里模拟器空间不足了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/Android-Notification的使用/" itemprop="url">
                  Android Notification的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-14T00:02:12+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1：获取NotificationManager:<br>NotificationManager m_NotificationManager=(NotificationManager)this.getSystemService(NOTIFICATION_SERVICE);</p>
<p>2:定义一个Notification:<br>  Notification  m_Notification=new Notification();</p>
<p>3:设置Notification的各种属性：<br> //设置通知在状态栏显示的图标<br>m_Notification.icon=R.drawable.icon;<br> //当我们点击通知时显示的内容<br>m_Notification.tickerText=”Button1 通知内容…..”;</p>
<p>通知时发出的默认声音<br>m_Notification.defaults=Notification.DEFAULT_SOUND;<br>//设置通知显示的参数<br>Intent   m_Intent=new Intent(NotificationDemo.this,DesActivity.class);<br>PendingIntent m_PendingIntent=PendingIntent.getActivity(NotificationDemo.this, 0, m_Intent, 0);<br>m_Notification.setLatestEventInfo(NotificationDemo.this, “Button1”, “Button1通知”,m_PendingIntent );<br>//这个可以理解为开始执行这个通知<br>m_NotificationManager.notify(0,m_Notification);</p>
<p>4：既然可以增加同样我们也可以删除。当然是只是删除你自己增加的。<br>  m_NotificationManager.cancel(0);<br>  这里的0是一个ID号码，和notify第一个参数0一样。<br>这也就完成了，添加删除工作。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/Android-短信发送/" itemprop="url">
                  Android 短信发送
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-13T23:59:36+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 短信管理模块</span><br><span class="line">public void SMSclick(View view) &#123;</span><br><span class="line"></span><br><span class="line">Log.v(&quot;sms&quot;, &quot;sms&quot;);</span><br><span class="line">// 调用Android系统API发送短信</span><br><span class="line">Uri uri = Uri.parse(&quot;smsto:5556&quot;);</span><br><span class="line">Intent intent = new Intent(Intent.ACTION_SENDTO, uri);</span><br><span class="line">intent.putExtra(&quot;sms_body&quot;, &quot;android...&quot;);</span><br><span class="line">startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//发送短信管理模块</span><br><span class="line">public void SMSsend(View view)&#123;</span><br><span class="line">  </span><br><span class="line">    PendingIntent pi = PendingIntent.getActivity(this, 0,    new Intent(this, MainActivity.class), 0);</span><br><span class="line">  </span><br><span class="line">    SmsManager sms = SmsManager.getDefault();</span><br><span class="line">  </span><br><span class="line">    sms.sendTextMessage(&quot;5554&quot;, null, &quot;aa&quot;, pi, null);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/Java-RMI/" itemprop="url">
                  Java RMI
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-13T23:53:49+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Java RMI 指的是远程方法调用 (Remote Method Invocation)。它是一种机制，能够让在某个 Java 虚拟机上的对象调用另一个 Java 虚拟机中的对象上的方法。可以用此方法调用的任何对象必须实现该远程接口。</p>
<p>Java RMI不是什么新技术（在Java1.1的时代都有了），但却是是非常重要的底层技术。<br>大名鼎鼎的EJB都是建立在rmi基础之上的，现在还有一些开源的远程调用组件，其底层技术也是rmi。</p>
<p>在大力鼓吹Web Service、SOA的时代，是不是每个应用都应该选用笨拙的Web Service组件来实现，通过对比测试后，RMI是最简单的，在一些小的应用中是最合适的。</p>
<p>下面通过一个简单的例子来说明RMI的原理和应用，下面这个例子是一个简单HelloWorld，但已涵盖RMI的核心应用与开发模式。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">/** </span><br><span class="line">* Created by IntelliJ IDEA. </span><br><span class="line">* User: leizhimin </span><br><span class="line">* Date: 2008-8-7 21:50:02 </span><br><span class="line">* 定义一个远程接口，必须继承Remote接口，其中需要远程调用的方法必须抛出RemoteException异常 </span><br><span class="line">*/ </span><br><span class="line">public interface IHello extends Remote &#123; </span><br><span class="line"></span><br><span class="line">    /** </span><br><span class="line">     * 简单的返回“Hello World！&quot;字样 </span><br><span class="line">     * @return 返回“Hello World！&quot;字样 </span><br><span class="line">     * @throws java.rmi.RemoteException </span><br><span class="line">     */ </span><br><span class="line">    public String helloWorld() throws RemoteException; </span><br><span class="line"></span><br><span class="line">    /** </span><br><span class="line">     * 一个简单的业务方法，根据传入的人名返回相应的问候语 </span><br><span class="line">     * @param someBodyName  人名 </span><br><span class="line">     * @return 返回相应的问候语 </span><br><span class="line">     * @throws java.rmi.RemoteException </span><br><span class="line">     */ </span><br><span class="line">    public String sayHelloToSomeBody(String someBodyName) throws RemoteException; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line">/** </span><br><span class="line">* Created by IntelliJ IDEA. </span><br><span class="line">* User: leizhimin </span><br><span class="line">* Date: 2008-8-7 21:56:47 </span><br><span class="line">* 远程的接口的实现 </span><br><span class="line">*/ </span><br><span class="line">public class HelloImpl extends UnicastRemoteObject implements IHello &#123; </span><br><span class="line">    /** </span><br><span class="line">     * 因为UnicastRemoteObject的构造方法抛出了RemoteException异常，因此这里默认的构造方法必须写，必须声明抛出RemoteException异常 </span><br><span class="line">     * </span><br><span class="line">     * @throws RemoteException </span><br><span class="line">     */ </span><br><span class="line">    public HelloImpl() throws RemoteException &#123; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    /** </span><br><span class="line">     * 简单的返回“Hello World！&quot;字样 </span><br><span class="line">     * </span><br><span class="line">     * @return 返回“Hello World！&quot;字样 </span><br><span class="line">     * @throws java.rmi.RemoteException </span><br><span class="line">     */ </span><br><span class="line">    public String helloWorld() throws RemoteException &#123; </span><br><span class="line">        return &quot;Hello World!&quot;; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    /** </span><br><span class="line">     * 一个简单的业务方法，根据传入的人名返回相应的问候语 </span><br><span class="line">     * </span><br><span class="line">     * @param someBodyName 人名 </span><br><span class="line">     * @return 返回相应的问候语 </span><br><span class="line">     * @throws java.rmi.RemoteException </span><br><span class="line">     */ </span><br><span class="line">    public String sayHelloToSomeBody(String someBodyName) throws RemoteException &#123; </span><br><span class="line">        return &quot;你好，&quot; + someBodyName + &quot;!&quot;; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">/** </span><br><span class="line">* Created by IntelliJ IDEA. </span><br><span class="line">* User: leizhimin </span><br><span class="line">* Date: 2008-8-7 22:03:35 </span><br><span class="line">* 创建RMI注册表，启动RMI服务，并将远程对象注册到RMI注册表中。 </span><br><span class="line">*/ </span><br><span class="line">public class HelloServer &#123; </span><br><span class="line">    public static void main(String args[]) &#123; </span><br><span class="line"></span><br><span class="line">        try &#123; </span><br><span class="line">            //创建一个远程对象 </span><br><span class="line">            IHello rhello = new HelloImpl(); </span><br><span class="line">            //本地主机上的远程对象注册表Registry的实例，并指定端口为8888，这一步必不可少（Java默认端口是1099），必不可缺的一步，缺少注册表创建，则无法绑定对象到远程注册表上 </span><br><span class="line">            LocateRegistry.createRegistry(8888); </span><br><span class="line"></span><br><span class="line">            //把远程对象注册到RMI注册服务器上，并命名为RHello </span><br><span class="line">            //绑定的URL标准格式为：rmi://host:port/name(其中协议名可以省略，下面两种写法都是正确的） </span><br><span class="line">            Naming.bind(&quot;rmi://localhost:8888/RHello&quot;,rhello); </span><br><span class="line">//            Naming.bind(&quot;//localhost:8888/RHello&quot;,rhello); </span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;INFO:远程IHello对象绑定成功！&quot;); </span><br><span class="line">        &#125; catch (RemoteException e) &#123; </span><br><span class="line">            System.out.println(&quot;创建远程对象发生异常！&quot;); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; catch (AlreadyBoundException e) &#123; </span><br><span class="line">            System.out.println(&quot;发生重复绑定对象异常！&quot;); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; catch (MalformedURLException e) &#123; </span><br><span class="line">            System.out.println(&quot;发生URL畸形异常！&quot;); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line">/** </span><br><span class="line">* Created by IntelliJ IDEA. </span><br><span class="line">* User: leizhimin </span><br><span class="line">* Date: 2008-8-7 22:21:07 </span><br><span class="line">* 客户端测试，在客户端调用远程对象上的远程方法，并返回结果。 </span><br><span class="line">*/ </span><br><span class="line">public class HelloClient &#123; </span><br><span class="line">    public static void main(String args[])&#123; </span><br><span class="line">        try &#123; </span><br><span class="line">            //在RMI服务注册表中查找名称为RHello的对象，并调用其上的方法 </span><br><span class="line">            IHello rhello =(IHello) Naming.lookup(&quot;rmi://localhost:8888/RHello&quot;); </span><br><span class="line">            System.out.println(rhello.helloWorld()); </span><br><span class="line">            System.out.println(rhello.sayHelloToSomeBody(&quot;熔岩&quot;)); </span><br><span class="line">        &#125; catch (NotBoundException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; catch (MalformedURLException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; catch (RemoteException e) &#123; </span><br><span class="line">            e.printStackTrace();   </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结：<br>从上面的过程来看，RMI对服务器的IP地址和端口依赖很紧密，但是在开发的时候不知道将来的服务器IP和端口如何，但是客户端程序依赖这个IP和端口。<br>这也是RMI的局限性之一。这个问题有两种解决途径：一是通过DNS来解决，二是通过封装将IP暴露到程序代码之外。<br>RMI的局限性之二是RMI是Java语言的远程调用，两端的程序语言必须是Java实现，对于不同语言间的通讯可以考虑用Web Service或者公用对象请求代理体系（CORBA）来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http://java.sun.com/javase/6/docs/technotes/guides/rmi/index.html</span><br><span class="line"> </span><br><span class="line">http://java.sun.com/javase/6/docs/technotes/guides</span><br><span class="line"> </span><br><span class="line">http://docs.huihoo.com/java/rmi/whitepage/index.html</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/Android-ListView优化几种写法详细介/" itemprop="url">
                  Android ListView优化几种写法详细介
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:22:37+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>详细出处参考：<a href="http://www.jb51.net/article/31886.htm" target="_blank" rel="external">http://www.jb51.net/article/31886.htm</a></p>
<p>一个显示一个垂直的滚动子项的列表视图在android开发中，使用listview的地方很多，用它来展现数据，成一个垂直的视图。使用listview是一个标准的适配器模式，用数据–，界面–xml以及适配器–adapter，数据被适配器按照需要的方式展现出来，xml描写了数据如何展现，activity中控制这些活动。 </p>
<p>其中使用自定义的adapter，会要重写getView方法，在getView方法产生给用户item的视图以及数据。 </p>
<p>这里有一个优化的地方，就是重用view，这样减少内存消耗，同时加快item加载速度。<br>在getView中优化的地方，大家想必都非常情况，下面我总结了三种优化的写法，请大家指正。<br>第一：<br>重用了convertView，很大程度上的减少了内存的消耗。通过判断convertView是否为null，是的话就需要产生一个视图出来，然后给这个视图数据，最后将这个视图返回给底层，呈献给用户。<br>特点：如果当前的convertView为null，则通过LayoutInflat产生一个view。 </p>
<p>复制代码 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ViewCode </span><br><span class="line">publicViewgetView(intposition,ViewconvertView,ViewGroupparent) </span><br><span class="line">&#123; </span><br><span class="line">if(convertView==null) </span><br><span class="line">&#123; </span><br><span class="line">convertView=LayoutInflater.from(context).inflate(R.layout.section_list_item1,null); </span><br><span class="line">&#125; </span><br><span class="line">TextViewtv_name=(TextView)convertView.findViewById(R.id.contact_contactinfoitem_tv_name); </span><br><span class="line">TextViewtv_phone=(TextView)convertView.findViewById(R.id.contact_contactinfoitem_tv_phoneNum); </span><br><span class="line">ContactInfo1confo=contacts.get(position); </span><br><span class="line">if(confo!=null)&#123;//toseteveryitem&apos;stext </span><br><span class="line">tv_name.setText(confo.getContactName()); </span><br><span class="line">tv_phone.setText(confo.getContact_Phone()); </span><br><span class="line">&#125; </span><br><span class="line">returnconvertView; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二：<br>上面的写法会有一个缺点，就是每次在getVIew的时候，都需要重新的findViewById，重新找到控件，然后进行控件的赋值以及事件相应设置。这样其实在做重复的事情，因为的geiview中，其实包含有这些控件，而且这些控件的id还都是一样的，也就是其实只要在view中findViewById一次，后面无需要每次都要findViewById了。<br>下面给出第二种写法<br>写发的特点，通常有一个内部类classViewHolder,这个ViewHolder,用来标识view中一些控件，方便进行一些事件相应操作的设置，比如onClick等等，这样可以不用每次都要findViewById了，减少了性能的消耗。同时重用了convertView，很大程度上的减少了内存的消耗。<br>复制代码 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ViewCode </span><br><span class="line">publicViewgetView(intposition,ViewconvertView,ViewGroupparent) </span><br><span class="line">&#123; </span><br><span class="line">ViewHolderholder; </span><br><span class="line">if(convertView==null)&#123; </span><br><span class="line">convertView=LayoutInflater.from(context).inflate(R.layout.section_list_item1,null); </span><br><span class="line">holder=newViewHolder(); </span><br><span class="line">holder.tv_name=(TextView)convertView.findViewById(R.id.contact_contactinfoitem_tv_name); </span><br><span class="line">holder.tv_phone=(TextView)convertView.findViewById(R.id.contact_contactinfoitem_tv_phoneNum); </span><br><span class="line">convertView.setTag(holder); </span><br><span class="line">&#125; </span><br><span class="line">else </span><br><span class="line">&#123; </span><br><span class="line">holder=(ViewHolder)convertView.getTag(); </span><br><span class="line">&#125; </span><br><span class="line">ContactInfo1confo=contacts.get(position); </span><br><span class="line">Log.i(&quot;my&quot;,&quot;confo&quot;+confo.getContactName()); </span><br><span class="line">if(confo!=null)&#123;//toseteveryitem&apos;stext </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">holder.tv_name.setText(confo.getContactName()); </span><br><span class="line">holder.tv_phone.setText(confo.getContact_Phone()); </span><br><span class="line">&#125; </span><br><span class="line">returnconvertView; </span><br><span class="line">&#125; </span><br><span class="line">classViewHolder </span><br><span class="line">&#123; </span><br><span class="line">TextViewtv_name,tv_phone; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三：<br>　个人觉得这个写法是最舒服的，最舒服的意思是看着代码有一种很爽，看的很清晰。<br>特点，使用了内部类classViewHolder、重用了convertView。<br>区别第二种写法是，使用了一个临时变量Viewview=convertView，然后修改view，最后返回view<br>复制代码 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ViewCode </span><br><span class="line">@Override </span><br><span class="line">publicViewgetView(intposition,ViewconvertView,ViewGroupparent) </span><br><span class="line">&#123; </span><br><span class="line">Viewview=convertView; </span><br><span class="line">ViewHolderholder; </span><br><span class="line">if(view==null)&#123; </span><br><span class="line">view=LayoutInflater.from(context).inflate(R.layout.section_list_item1,null); </span><br><span class="line">holder=newViewHolder(); </span><br><span class="line">holder.tv_name=(TextView)view.findViewById(R.id.contact_contactinfoitem_tv_name); </span><br><span class="line">holder.tv_phone=(TextView)view.findViewById(R.id.contact_contactinfoitem_tv_phoneNum); </span><br><span class="line">view.setTag(holder); </span><br><span class="line">&#125; </span><br><span class="line">else </span><br><span class="line">&#123; </span><br><span class="line">holder=(ViewHolder)view.getTag(); </span><br><span class="line">&#125; </span><br><span class="line">ContactInfo1confo=contacts.get(position); </span><br><span class="line">Log.i(&quot;my&quot;,&quot;confo&quot;+confo.getContactName()); </span><br><span class="line">if(confo!=null)&#123;//toseteveryitem&apos;stext </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">holder.tv_name.setText(confo.getContactName()); </span><br><span class="line">holder.tv_phone.setText(confo.getContact_Phone()); </span><br><span class="line">&#125; </span><br><span class="line">returnview; </span><br><span class="line">&#125; </span><br><span class="line">classViewHolder </span><br><span class="line">&#123; </span><br><span class="line">TextViewtv_name,tv_phone; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是集中写法，供新手学习和总结。<br>源代码如下：LisViewTest.zip<br>根据楼下朋友提供的建议，发现还有优化的地方，最新更新如下：<br>复制代码 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ViewCode </span><br><span class="line">@Override </span><br><span class="line">publicViewgetView(intposition,ViewconvertView,ViewGroupparent) </span><br><span class="line">&#123; </span><br><span class="line">Viewview=convertView; </span><br><span class="line">ViewHolderholder; </span><br><span class="line">if(view==null)&#123; </span><br><span class="line">view=LayoutInflater.from(context).inflate(R.layout.section_list_item1,null); </span><br><span class="line">holder=newViewHolder(); </span><br><span class="line">holder.tv_name=(TextView)view.findViewById(R.id.contact_contactinfoitem_tv_name); </span><br><span class="line">holder.tv_phone=(TextView)view.findViewById(R.id.contact_contactinfoitem_tv_phoneNum); </span><br><span class="line">view.setTag(holder); </span><br><span class="line">&#125; </span><br><span class="line">else </span><br><span class="line">&#123; </span><br><span class="line">holder=(ViewHolder)view.getTag(); </span><br><span class="line">&#125; </span><br><span class="line">ContactInfo1confo=contacts.get(position); </span><br><span class="line">Log.i(&quot;my&quot;,&quot;confo&quot;+confo.getContactName()); </span><br><span class="line">if(confo!=null)&#123;//toseteveryitem&apos;stext </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">holder.tv_name.setText(confo.getContactName()); </span><br><span class="line">holder.tv_phone.setText(confo.getContact_Phone()); </span><br><span class="line">&#125; </span><br><span class="line">returnview; </span><br><span class="line">&#125; </span><br><span class="line">&lt;fontcolor=&quot;\&quot;#0000ff\&quot;&quot;&gt;&lt;/font&gt;staticclassViewHolder </span><br><span class="line">&#123; </span><br><span class="line">TextViewtv_name,tv_phone; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：staticclassViewHolder<br>这里设置ViewHolder为static，也就是静态的，静态类只会在第一次加载时会耗费比较长时间，但是后面就可以很好帮助加载，同时保证了内存中只有一个ViewHolder，节省了内存的开销。<br>非常感谢大家提出建议以及大家的关注！<br>详细出处参考：<a href="http://www.jb51.net/article/31886.htm" target="_blank" rel="external">http://www.jb51.net/article/31886.htm</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/Android开发遇到的Exception/" itemprop="url">
                  Android开发遇到的Exception
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:15:20+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>在使用BaseAdapter的问题</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: The observer is null.</span><br><span class="line">at android.database.Observable.unregisterObserver(Observable.java:64)</span><br><span class="line">at android.widget.BaseAdapter.unregisterDataSetObserver(BaseAdapter.java:42)</span><br><span class="line">at android.widget.AbsListView.onDetachedFromWindow(AbsListView.java:2872)</span><br><span class="line">at android.view.View.dispatchDetachedFromWindow(View.java:11908)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2647)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewGroup.dispatchDetachedFromWindow(ViewGroup.java:2645)</span><br><span class="line">at android.view.ViewRootImpl.dispatchDetachedFromWindow(ViewRootImpl.java:2685)</span><br><span class="line">at android.view.ViewRootImpl.doDie(ViewRootImpl.java:4044)</span><br><span class="line">at android.view.ViewRootImpl.die(ViewRootImpl.java:4027)</span><br><span class="line">at android.view.WindowManagerImpl.removeViewImmediate(WindowManagerImpl.java:375)</span><br><span class="line">at android.view.WindowManagerImpl$CompatModeWrapper.removeViewImmediate(WindowManagerImpl.java:170)</span><br><span class="line">at android.app.ActivityThread.handleDestroyActivity(ActivityThread.java:3352)</span><br><span class="line">at android.app.ActivityThread.access$1200(ActivityThread.java:140)</span><br><span class="line">at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1266)</span><br><span class="line">at android.os.Handler.dispatchMessage(Handler.java:99)</span><br><span class="line">at android.os.Looper.loop(Looper.java:137)</span><br><span class="line">at android.app.ActivityThread.main(ActivityThread.java:4914)</span><br><span class="line">at java.lang.reflect.Method.invokeNative(Native Method)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:511)</span><br><span class="line">at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:808)</span><br><span class="line">at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:575)</span><br><span class="line">at dalvik.system.NativeStart.main(Native Method)</span><br></pre></td></tr></table></figure>
<p>解决方法，继承BaseAdapter的时候写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void unregisterDataSetObserver(DataSetObserver observer) &#123;</span><br><span class="line">if (observer != null) &#123;</span><br><span class="line">       super.unregisterDataSetObserver(observer);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p> 2.从网上新下载一个项目，导入到eclipse中运行时，报错：<br>java.lang.NoClassDefFoundError: com.baidu.mapapi.BMapManager<br>解决方案：<br>一、右击项目-&gt;properties-&gt;Java Build Path-&gt;Order and Export，在需要引用的包前面打勾。<br>二、Project-&gt;Clean…<br>问题解决，重新运行后就没什么问题了</p>
<hr>
<p>3.华为手机debug需要打开log开关<br> 方法：<br>1、在拨号界面输入：<em>#</em>#2846579#<em>#</em>  进入测试菜单界面<br>2、Project Menu–后台设置–LOG设置<br>3、LOG开关–LOG打开   LOG级别设置–VERBOSE<br>4、Dump&amp;Log– 全部选中<br>5、重启手机，重启Eclipse</p>
<hr>
<p>4.未知异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.UnsatisfiedLinkError: Couldn&apos;t load zbar from loader dalvik.system.PathClassLoader[DexPathList[[zip file &quot;/data/app/com.haigou.client-1.apk&quot;],nativeLibraryDirectories=[/data/app-lib/com.haigou.client-1, /vendor/lib, /system/lib]]]: findLibrary returned null</span><br><span class="line"> at java.lang.Runtime.loadLibrary(Runtime.java:358)</span><br><span class="line"> at java.lang.System.loadLibrary(System.java:526)</span><br><span class="line"> at com.zbar.lib.ZbarManager.&lt;clinit&gt;(ZbarManager.java:15)</span><br><span class="line"> at com.zbar.lib.decode.DecodeHandler.decode(DecodeHandler.java:56)</span><br><span class="line"> at com.zbar.lib.decode.DecodeHandler.handleMessage(DecodeHandler.java:38)</span><br><span class="line"> at android.os.Handler.dispatchMessage(Handler.java:102)</span><br><span class="line"> at android.os.Looper.loop(Looper.java:136)</span><br><span class="line"> at com.zbar.lib.decode.DecodeThread.run(DecodeThread.java:44)</span><br></pre></td></tr></table></figure>
<p>解决方式： .so文件拷贝到armeabi-v7a</p>
<hr>
<p> 5.未知异常<br> import com.sun.image.codec.jpeg.JPEGCodec不通过 找不到包<br> 在Eclipse中处理图片，需要引入两个包：<br>import com.sun.image.codec.jpeg.JPEGCodec;<br>import com.sun.image.codec.jpeg.JPEGImageEncoder;<br>报错:<br>Access restriction: The type JPEGImageEncoder is not accessible due to restriction on required library C:\Java\jre1.6.0_07\lib\rt.jar</p>
<p>此时解决办法：<br>Eclipse默认把这些受访问限制的API设成了ERROR。只要把Windows-Preferences-Java-Complicer-Errors/Warnings里面的Deprecated and restricted API中的Forbidden references(access rules)选为Warning就可以编译通过。</p>
<hr>
<p>6.未知异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Don&apos;t call setOnClickListener for an AdapterView</span><br></pre></td></tr></table></figure>
<p>不能再AdapterView不能设置onClickListener，否则会直接抛出异常</p>
<hr>
<p>7.eclipse项目导入异常<br> 1，右键项目名称</p>
<p>  BuildPath —&gt; Configure Build Paht…中，然后上面有几个选项卡找到 Libraries中出现红色叉号的包为路径错误的包。<br>  到classpath中修改相应包的当前路径。然后回到eclipse中F5刷新工程。<br>不行的话可以试试clean项目;<br>project—&gt;clean<br>如果你的eclipse项目有红色叹号，而Libraries中没有出现红色叉号的包，我是这样做的。<br>1，先把eclipse转换到Markers视图，windows—-&gt;show view —-&gt;markers<br>会发现这些报错内容，<br>Archive for required library: ‘XXXXXXXX001’ in project ‘xxxxxxxxx’ cannot be read or is not a valid ZIP file<br>2，用记事本打开项目根目录的.classpath文件，找到“<classpathentry kind="”lib”" path="”XXXXXXXXX001”/">”这一行，删掉<br>保存，刷新后，这个报错就没有了，从而红色叹号也没有了。</classpathentry></p>
<hr>
<p>8.eclipse打包时字符串多国语言处理<br> 打包时字符串多国语言问题(Checks for incomplete translations where not all st<br>Android Lint Preference  –  ignore all</p>
<hr>
<p>9.未知异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: View=com.android.internal.policy.impl.PhoneWindow$DecorView&#123;4278dfe8 V.E..... R.....ID 0,0-1248,288&#125; not attached to window manager</span><br><span class="line"> at android.view.WindowManagerGlobal.findViewLocked(WindowManagerGlobal.java:370)</span><br><span class="line"> at android.view.WindowManagerGlobal.removeView(WindowManagerGlobal.java:299)</span><br><span class="line"> at android.view.WindowManagerImpl.removeViewImmediate(WindowManagerImpl.java:84)</span><br><span class="line"> at android.app.Dialog.dismissDialog(Dialog.java:329)</span><br><span class="line"> at android.app.Dialog.dismiss(Dialog.java:312)</span><br><span class="line"> at android.app.Dialog.cancel(Dialog.java:1114)</span><br><span class="line"> at com.haigou.activity.MainActivity$WebHandler.handleMessage(MainActivity.java:964)</span><br><span class="line"> at android.os.Handler.dispatchMessage(Handler.java:102)</span><br><span class="line"> at android.os.Looper.loop(Looper.java:136)</span><br><span class="line"> at android.app.ActivityThread.main(ActivityThread.java:5034)</span><br><span class="line"> at java.lang.reflect.Method.invokeNative(Native Method)</span><br><span class="line"> at java.lang.reflect.Method.invoke(Method.java:515)</span><br><span class="line"> at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:807)</span><br><span class="line"> at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:623)</span><br><span class="line"> at dalvik.system.NativeStart.main(Native Method)</span><br></pre></td></tr></table></figure>
<p> 异步消息造成的问题</p>
<hr>
<p>10.未知异常<br>Conversion to Dalvik format failed: Unable to execute dex:<br>两个包有内容重复或冲突之类,同一项目中多次引用或者多次导包导致冲突</p>
<hr>
<p>11.未知异常<br>Installation error: INSTALL_FAILED_INSUFFICIENT_STORAGE</p>
<hr>
<p>选择你的应用，右键选择【run as】–【run configurations】–【target】–【Additional Emulator Command Line Options】，填写“-partition-size 256”</p>
<hr>
<p>12.addview() 不执行removeView会报出异常，addView后，你要添加的view就一直存在添加view的容器中，不removeView不会有什么情况，是不过在你要想在addView上次的view之前必须先把removeView 掉，否则会提示你view已存在异常。</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/GridView常用属性/" itemprop="url">
                  GridView常用属性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-13T18:29:36+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="属性名称"><a href="#属性名称" class="headerlink" title="属性名称"></a>属性名称</h3><p>描述<br>android:columnWidth<br>设置列的宽度。<br>android:gravity<br>设置此组件中的内容在组件中的位置。可选的值有：top、bottom、left、right、center_vertical、fill_vertical、center_horizontal、fill_horizontal、center、fill、clip_vertical可以多选，用“|”分开。<br>android:horizontalSpacing<br>两列之间的间距。<br>android:numColumns<br>设置列数。<br>android:stretchMode<br>缩放模式。<br>android:verticalSpacing<br>两行之间的间距。</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/Android-应用添加快捷方式/" itemprop="url">
                  Android 应用添加快捷方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-13T18:02:31+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>添加快捷方式需要向Luncher发送请求生成快捷方式</p>
<p>系统的broadcast receiver</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;receiver                </span><br><span class="line">    android:name=&quot;com.android.launcher2.InstallShortcutReceiver&quot;                </span><br><span class="line">    android:permission=&quot;com.android.launcher.permission.INSTALL_SHORTCUT&quot;&gt;                </span><br><span class="line">    &lt;intent-filter&gt;                    </span><br><span class="line">        &lt;action android:name=&quot;com.android.launcher.action.INSTALL_SHORTCUT&quot; /&gt;                </span><br><span class="line">    &lt;/intent-filter&gt;            </span><br><span class="line">&lt;/receiver&gt;</span><br></pre></td></tr></table></figure>
<p>所以需要在桌面上创建快捷方式就需要权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;com.android.launcher.permission.INSTALL_SHORTCUT&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>创建快捷方式代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public void createShortCut()&#123;     </span><br><span class="line">    //创建快捷方式的Intent                     </span><br><span class="line">    Intent shortcutintent = new Intent(&quot;com.android.launcher.action.INSTALL_SHORTCUT&quot;);                     </span><br><span class="line">    //不允许重复创建                     </span><br><span class="line">    shortcutintent.putExtra(&quot;duplicate&quot;, false);                     </span><br><span class="line">    //需要现实的名称                     </span><br><span class="line">    shortcutintent.putExtra(Intent.EXTRA_SHORTCUT_NAME, getString(R.string.shortcutname));     </span><br><span class="line">    //快捷图片                    </span><br><span class="line">    Parcelable icon = Intent.ShortcutIconResource.fromContext(getApplicationContext(), R.drawable.icon);     </span><br><span class="line">    shortcutintent.putExtra(Intent.EXTRA_SHORTCUT_ICON_RESOURCE, icon);     </span><br><span class="line">    //点击快捷图片，运行的程序主入口                     </span><br><span class="line">    shortcutintent.putExtra(Intent.EXTRA_SHORTCUT_INTENT, new Intent(getApplicationContext() , EnterActivity.class));                     </span><br><span class="line">    //发送广播。OK                     </span><br><span class="line">    sendBroadcast(shortcutintent);     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="huanxingxyz" />
          <p class="site-author-name" itemprop="name">huanxingxyz</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">huanxingxyz</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
